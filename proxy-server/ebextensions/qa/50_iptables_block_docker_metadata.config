files:
  "/etc/sysconfig/iptables":
    mode: "00600"
    owner: root
    group: root
    encoding: plain
    content: |
      # Generated by iptables-save v1.4.18 on Wed Oct 30 01:33:48 2019 
      *nat
      :PREROUTING ACCEPT [2498:146469]
      :INPUT ACCEPT [2490:145992]
      :OUTPUT ACCEPT [104004:7506750]
      :POSTROUTING ACCEPT [151653:10365690]
      :DOCKER - [0:0]
      -A PREROUTING -m addrtype --dst-type LOCAL -j DOCKER
      -A PREROUTING -i eth0 -p tcp -m tcp --dport 80 -m comment --comment added_by_elasticbeanstalk -j DNAT --to-destination 172.17.0.2:9081
      -A OUTPUT ! -d 127.0.0.0/8 -m addrtype --dst-type LOCAL -j DOCKER
      -A OUTPUT -o lo -p tcp -m tcp --dport 80 -m comment --comment added_by_elasticbeanstalk -j DNAT --to-destination 172.17.0.2:9081
      -A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE
      -A POSTROUTING -s 127.0.0.1/32 -o docker0 -m comment --comment added_by_elasticbeanstalk -j MASQUERADE
      -A DOCKER -i docker0 -j RETURN
      COMMIT
      # Completed on Wed Oct 30 01:33:48 2019
      # Generated by iptables-save v1.4.18 on Wed Oct 30 01:33:48 2019
      *filter
      :INPUT ACCEPT [28:1948]
      :FORWARD DROP [0:0]
      :OUTPUT ACCEPT [15:1912]
      :DOCKER - [0:0]
      :DOCKER-ISOLATION-STAGE-1 - [0:0]
      :DOCKER-ISOLATION-STAGE-2 - [0:0]
      :DOCKER-USER - [0:0]
      -A FORWARD -j DOCKER-USER
      -A FORWARD -j DOCKER-ISOLATION-STAGE-1
      -A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
      -A FORWARD -o docker0 -j DOCKER
      -A FORWARD -i docker0 ! -o docker0 -j ACCEPT
      -A FORWARD -i docker0 -o docker0 -j ACCEPT
      -A FORWARD -i eth0 -o docker0 -m comment --comment added_by_elasticbeanstalk_forward -j ACCEPT
      -A DOCKER-ISOLATION-STAGE-1 -i docker0 ! -o docker0 -j DOCKER-ISOLATION-STAGE-2
      -A DOCKER-ISOLATION-STAGE-1 -j RETURN
      -A DOCKER-ISOLATION-STAGE-2 -o docker0 -j DROP
      -A DOCKER-ISOLATION-STAGE-2 -j RETURN
      -A DOCKER-USER -d 169.254.169.254/32 -j REJECT --reject-with icmp-port-unreachable
      -A DOCKER-USER -j RETURN
      COMMIT
      # Completed on Wed Oct 30 01:33:48 2019


services:
  sysvinit:
    iptables:
      enabled: "true"
      ensureRunning: "true"
      files: 
        - "/etc/sysconfig/iptables"
      commands: 
        - "service iptables restart"